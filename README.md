| Supported Targets | ESP32 | ESP32-C3 | ESP32-C6 | ESP32-H2 | ESP32-S2 | ESP32-S3 |
| ----------------- | ----- | -------- | -------- | -------- | -------- | -------- |
# Lab 2-Part 1

This lab is based on the Espressif LED Strip Example
(https://github.com/espressif/esp-idf/tree/master/examples/peripherals/rmt/led_strip)

(See the README.md file in the upper level 'examples' directory for more information about examples.)

Almost any waveform can be generated by the [RMT peripheral](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/rmt.html), as long as a proper encoder is implemented. The RMT encoder is used to encode user data (e.g. RGB pixels) into a format that can be recognized by hardware. 

This example shows how to drive an addressable [WS2812 LED strip](http://www.world-semi.com/Certifications/WS2812B.html) by implementing the [led_strip_encoder](main/led_strip_encoder.c).

Note that this example uses code that is similar to an older implementation of the [LED Strip Driver component](https://components.espressif.com/components/espressif/led_strip). While many of the concepts are similar, they are not fully compatible.

## How to Use Example

Before project configuration and build, be sure to set the correct chip target using `idf.py set-target esp32-s3`.

### Hardware Required

* An ESP32-S3-DevKitC-1 development board
* A USB cable for microcontroller power supply and programming
* A WS2812 LED strip
* A separate 5 V power supply for the LED strip if a large number of LEDs are used
* A solderless breadboard
* Jumper or Dupont wires (M/M, M/F) to connect components

Additional hardware used for lab exercise:

* 5 kÎ© potentiometer
* SPST-NO pushbutton

Connection :

```
                              --- 5V
                               |
                               +
RMT_LED_STRIP_GPIO_NUM +------ +---|>| (WS2812 LED strip)
                        DI     +
                               |
                              --- GND
```

The GPIO number used to connect to the data pin of the WS2812 LED strip is set to 14 by default. This and other default parameters can be changed by `idf.py menuconfig` > `Example Configuration`. Alternatively, the macros `RMT_LED_STRIP_GPIO_NUM`, `LED_STRIP_LENGTH`, and `LED_CHASE_SPEED_MS` can be redefined in the [source file](main/lab2.c).

### Build and Flash

Run `idf.py -p PORT flash monitor` to build, flash and monitor the project.

(To exit the serial monitor, type ``Ctrl-]``.)

See the [Getting Started Guide](https://docs.espressif.com/projects/esp-idf/en/latest/get-started/index.html) for full steps to configure and use ESP-IDF to build projects.

Alternatively, this project can be developed using [VSCode](https://code.visualstudio.com) with the [PlatformIO IDE](https://platformio.org/platformio-ide) extension and the [Espressif 32 platform](https://registry.platformio.org/platforms/platformio/espressif32) installed.

## Example Output

```
I (281) app_start: Starting scheduler on CPU0
I (286) app_start: Starting scheduler on CPU1
I (286) main_task: Started on CPU0
I (296) lab2: Create RMT TX channel
I (306) gpio: GPIO[14]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 1| Pulldown: 0| Intr:0 
I (316) lab2: Install led strip encoder
I (316) lab2: Enable RMT TX channel
I (326) lab2: Start LED rainbow chase
```

After seeing this log, you should see a rainbow chasing demonstration pattern.

## Exercise

After loading the example code and confirming that the strip LED is functioning properly, modify the example code to add the following functionality:

1. Change the LED pattern such that the sweep pattern consists of 5 LEDs, all displaying the same colour in a fading trail, similar to a comet. The first or "lead" LED should be brightest, the second LED somewhat dimmer, the third LED the dimmest, and the last two LEDs off. Assuming a strip of 10 LEDs, the pattern must repeat to fill the LED strip as shown below. The values represent the brightness of the individual LEDs at each time step.
```
1: [ 0] [ 0] [ 3] [20] [80] [ 0] [ 0] [ 3] [20] [80]
2: [80] [ 0] [ 0] [ 3] [20] [80] [ 0] [ 0] [ 3] [20]
3: [20] [80] [ 0] [ 0] [ 3] [20] [80] [ 0] [ 0] [ 3]
etc.
```

2. Add a potentiometer to control the sweep speed.
3. Add a pushbutton to change the pattern colour with each button press. The pattern should cycle through at least 4 different colours.

Consider updating [Kconfig.projbuild](main/Kconfig.projbuild) to allow the sweep parameters, and the GPIO pins used for the pushbutton and potentiometer, to be configured using `idf.py menuconfig`. The patterns used in the example should serve as a good starting point. Further information on the Kconfig formatting rules may be found [here](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/kconfig.html#kconfig-formatting-rules).

### Other Things to Explore

1. Add a second pushbutton to change the pattern direction, alternating between forward and reverse with each button press
2. Add a second potentiometer to control the overall brightness of the LEDs.
3. Adjust the sweep pattern so that it is made up of different colours.
4. Alter the sweep pattern in other ways that you think might be visually interesting.
